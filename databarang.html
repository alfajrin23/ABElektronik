<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Stok Data Barang - ABElektronik</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; 
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f6f9fc, #d9e4f5);
      color: #222;
      overflow-x: hidden;
      user-select: none;
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 390px;
      margin: 0 auto;
      padding: 20px 15px 100px;
      box-sizing: border-box;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }
    header h1 {
      font-weight: 700;
      font-size: 1.8rem;
      color: #2a3eb1;
      letter-spacing: 1.5px;
      text-shadow: 1px 1px 4px rgba(42, 62, 177, 0.6);
      animation: pulseShadow 3s ease-in-out infinite, zoomPulse 6s ease-in-out infinite;
    }
    @keyframes pulseShadow {
      0%, 100% { text-shadow: 1px 1px 4px rgba(42, 62, 177, 0.6); }
      50% { text-shadow: 1px 1px 10px rgba(74, 105, 255, 0.9); }
    }
    @keyframes zoomPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    .search-wrapper {
      position: relative;
      width: 100%;
      margin-bottom: 0.5rem;
    }
    #searchInput {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      box-shadow: 0 2px 8px rgba(42, 62, 177, 0.15);
      transition: box-shadow 0.4s ease, transform 0.3s ease;
      outline-offset: 2px;
      outline-color: #4a69ff;
      cursor: text;
    }
    #searchInput:focus {
      box-shadow: 0 6px 20px rgba(74, 105, 255, 0.7);
      transform: scale(1.03);
    }
    /* Search Icon */
    .search-icon {
      position: absolute;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      stroke: #4a69ffcc;
      transition: stroke 0.3s ease, transform 0.3s ease;
      pointer-events: none;
    }
    #searchInput:focus + .search-icon {
      stroke: #2a3eb1;
      transform: translateY(-50%) scale(1.15);
    }
    /* Table wrapper ensures no horizontal scroll */
    .table-wrapper {
      width: 100%;
      max-width: 390px;
      overflow-x: hidden;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(42, 62, 177, 0.1);
      background: white;
      max-height: 550px;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    
    thead {
      background: #2a3eb1;
      color: #fff;
      font-weight: 600;
      font-size: 0.85rem;
      user-select: none;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    table th {
      padding: 12px 8px;
      text-align: center;
      word-wrap: break-word;
    }
    table th:nth-child(2) { width: 5px; } /* Id */
    table th:nth-child(3) { width: 70px; } /* Nama Barang */
    table th:nth-child(4) { width: 60px; } /* Brand */
    table th:nth-child(5) { width: 5px; } /* Harga */
    table th:nth-child(6) { width: 10px; } /* Stok */
    table th:nth-child(7) { width: 100px; } /* Aksi */

    /* Atur lebar kolom checkbox */
table th:first-child {
    width: 5px; /* Atur lebar kolom checkbox sesuai kebutuhan */
    padding: 0; /* Hapus padding untuk menghemat ruang */
    text-align: center; /* Pusatkan teks di kolom */
}

table td:first-child {
    padding: 0; /* Hapus padding untuk menghemat ruang */
    text-align: center; /* Pusatkan teks di kolom */
}

    thead th {
      padding: 12px 8px;
      text-align: center;
      word-wrap: break-word;
    }
    tbody tr {
      border-bottom: 1px solid #eee;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      animation: fadeSlideUp 0.4s ease forwards;
      opacity: 0;
      transform: translateY(10px);
      cursor: pointer;
      position: relative;
    }
    /* Row highlight for selection */
    tbody tr.selected {
      background: #cfe0ff;
      box-shadow: inset 0 0 6px 3px #4a69ffaa;
    }
    /* Checkmark corner for selected rows */
    tbody tr.selected::before {
      content: "‚úî";
      position: absolute;
      top: 6px;
      left: 6px;
      font-size: 1rem;
      color: #2a3eb1;
      font-weight: 700;
      user-select: none;
    }
    tbody tr.visible {
      opacity: 1;
      transform: translateY(0);
    }
    tbody tr:hover:not(.selected) {
      background: #e7ebff;
      box-shadow: inset 5px 0 15px #4a69ff44;
    }
    tbody td {
      text-align: center;
      padding: 10px 8px;
      font-size: 0.9rem;
      color: #444;
      word-wrap: break-word;
      user-select: text;
    }
    tbody td.name, tbody td.brand {
      text-align: left;
      padding-left: 15px;
    }
    /* Price styling with Rp stacked above price */
    tbody td.price {
      color: #2a3eb1;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      align-items: center;
      white-space: nowrap;
    }
    tbody td.price .currency {
      font-size: 0.6rem;
      font-weight: 400;
      opacity: 0.7;
      line-height: 1.1;
      margin-bottom: 1px;
      user-select: none;
    }
    tbody td.price .amount {
      font-size: 1rem;
      line-height: 1.2;
    }
    tbody td.stock {
      color: #17a2b8;
      font-weight: 700;
      white-space: nowrap;
    }
    /* Actions Icons */
    .actions {
      display: flex;
      justify-content: center;
      gap: 1px;
    }
    .actions button {
      background: transparent;
      border: none;
      cursor: pointer;
      color: #2a3eb1;
      font-size: 1.2rem;
      transition: color 0.25s ease, transform 0.2s ease;
      outline-offset: 3px;
    }
    .actions button.edit:hover {
      color: #28a745;
      transform: scale(1.15);
    }
    .actions button.delete:hover {
      color: #dc3545;
      transform: scale(1.15);
    }
    .actions button:focus-visible {
      outline: 2px solid #4a69ff;
      border-radius: 6px;
    }
    /* Bottom Buttons */
    .bottom-buttons {
      position: fixed;
      bottom: 20px;
      right: 15px;
      display: flex;
      gap: 12px;
      z-index: 50;
    }
    button.primary, button.secondary {
      padding: 10px 15px;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 9999px;
      border: none;
      box-shadow: 0 4px 12px rgba(42, 62, 177, 0.3);
      cursor: pointer;
      user-select: none;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background-color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      will-change: transform, box-shadow;
    }
    button.primary {
      background: #4a69ff;
      color: white;
    }
    button.primary:hover {
      background: #2a3eb1;
      box-shadow: 0 6px 20px #4a69ffcc;
      transform: translateY(-3px) scale(1.05);
    }
    button.primary:active {
      transform: translateY(-1px) scale(0.95);
      box-shadow: 0 3px 10px #2a3eb144;
    }
    button.secondary {
      background: #17a2b8;
      color: white;
    }
    button.secondary:hover {
      background: #0f6674;
      box-shadow: 0 6px 20px #17a2b8cc;
      transform: translateY(-3px) scale(1.05);
    }
    button.secondary:active {
      transform: translateY(-1px) scale(0.95);
      box-shadow: 0 3px 10px #0f667444;
    }
    /* Icon styles in buttons */
    .icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      stroke-width: 2.5;
    }
    @keyframes fadeSlideUp {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Modal Styles - keeping original functionality */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }
    .modal {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      padding: 24px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      position: relative;
      font-weight: 500;
      color: #004a99;
      box-sizing: border-box;
    }
    .modal h2 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #2a3eb1;
      font-size: 1.5rem;
      font-weight: 700;
      border-bottom: 2px solid #4a69ff;
      padding-bottom: 6px;
      letter-spacing: 0.03em;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 1rem;
      color: #2a3eb1;
    }
    .input-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 2px solid #4a69ff;
      border-radius: 8px;
      outline-offset: 2px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      color: #2a3eb1;
      background-color: #fff;
      font-weight: 500;
      box-sizing: border-box;
    }
    input[type="text"]::placeholder, input[type="number"]::placeholder {
      color: #8cb0ff;
      font-weight: 500;
    }
    input[type="text"]:focus, input[type="number"]:focus {
      border-color: #2a3eb1;
      box-shadow: 0 0 8px rgba(74, 105, 255, 0.7);
      outline: none;
    }
    button.scan-barcode-btn {
      background-color: #17a2b8;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }
    button.scan-barcode-btn:hover {
      background-color: #0f6674;
      outline: none;
    }
    button.scan-barcode-btn svg {
      width: 20px;
      height: 20px;
      stroke: white;
      fill: none;
    }
    .modal-buttons {
      margin-top: 24px;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    .modal-buttons button {
      padding: 10px 20px;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .modal-buttons button.save-btn {
      background-color: #4a69ff;
      color: white;
      box-shadow: 0 2px 6px rgba(74, 105, 255, 0.8);
    }
    .modal-buttons button.save-btn:hover {
      background-color: #2a3eb1;
      box-shadow: 0 4px 10px rgba(42, 62, 177, 0.9);
    }
    .modal-buttons button.cancel-btn {
      background-color: #ccc;
      color: #333;
    }
    .modal-buttons button.cancel-btn:hover {
      background-color: #999;
      color: white;
    }
    /* Scanner container for Quagga */
    #scanner-container {
      display: none;
      position: relative;
      margin-top: 10px;
      border: 2px solid #4a69ff;
      border-radius: 8px;
      width: 100%;
      max-width: 360px;
      height: 300px;
      background: black;
      z-index: 4000;
    }
    #scanner-container #closeScannerBtn {
      position: absolute;
      top: 5px;
      right: 5px;
      z-index: 10;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 20px;
      line-height: 20px;
      text-align: center;
      padding: 0;
    }
    #interactive.viewport {
      width: 100%;
      height: 100%;
      overflow: hidden;
      border-radius: 8px;
    }

    #scanner-container {
    display: none;
    position: relative;
    margin-top: 10px;
    border: 2px solid #4a69ff;
    border-radius: 8px;
    width: 100%;
    max-width: 360px;
    height: 300px;
    background: black;
    z-index: 4000;
    overflow: hidden;
}

#scanner-container #closeScannerBtn {
    position: absolute;
    top: 5px;
    right: 5px;
    z-index: 10;
    background: #dc3545;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 18px;
    line-height: 18px;
    text-align: center;
    padding: 0;
    font-weight: bold;
}

#interactive.viewport {
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 6px;
}

#interactive canvas, #interactive video {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover;
}


.drawingBuffer {
    position: absolute;
    top: 0;
    left: 0;
}

/* Modal Barcode Viewer */
.barcode-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 4000;
}

.barcode-modal {
    background: white;
    border-radius: 15px;
    width: 95%;
    max-width: 500px;
    max-height: 90vh;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    position: relative;
    overflow-y: auto;
}

.barcode-modal h2 {
    margin: 0 0 20px 0;
    color: #2a3eb1;
    font-size: 1.5rem;
    text-align: center;
    border-bottom: 2px solid #4a69ff;
    padding-bottom: 10px;
}

.barcode-preview-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.barcode-item {
    border: 2px solid #e0e6ff;
    border-radius: 10px;
    padding: 15px;
    background: #f8f9ff;
    text-align: center;
}

.barcode-item canvas {
    max-width: 100%;
    height: auto;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.barcode-item-info {
    color: #2a3eb1;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 10px;
}

.barcode-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.barcode-btn {
    padding: 12px 20px;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    min-width: 130px;
    justify-content: center;
}

.barcode-btn.save-png {
    background: #28a745;
    color: white;
}

.barcode-btn.save-png:hover {
    background: #218838;
    transform: translateY(-2px);
}

.barcode-btn.save-pdf {
    background: #dc3545;
    color: white;
}

.barcode-btn.save-pdf:hover {
    background: #c82333;
    transform: translateY(-2px);
}

.barcode-btn.view-full {
    background: #17a2b8;
    color: white;
}

.barcode-btn.view-full:hover {
    background: #138496;
    transform: translateY(-2px);
}

.barcode-btn.close-modal {
    background: #6c757d;
    color: white;
}

.barcode-btn.close-modal:hover {
    background: #545b62;
    transform: translateY(-2px);
}

/* Fullscreen barcode viewer */
.fullscreen-barcode {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 5000;
    flex-direction: column;
    gap: 20px;
}

.fullscreen-barcode canvas {
    max-width: 90vw;
    max-height: 70vh;
    border: 2px solid white;
    border-radius: 10px;
}

.fullscreen-nav {
    display: flex;
    gap: 20px;
    align-items: center;
}

.fullscreen-nav button {
    background: rgba(255,255,255,0.2);
    border: 1px solid white;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
}

.fullscreen-nav button:hover {
    background: rgba(255,255,255,0.3);
}

.fullscreen-counter {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

.barcode-btn svg {
    width: 18px;
    height: 18px;
}
  </style>
  <!-- Load Quagga.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script> 
  <!-- Firebase App (core SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <!-- Firestore SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container" role="main" aria-label="Stok Data Barang">
  <header>
    <h1>Stok Data Barang</h1>
  </header>
  <div class="search-wrapper">
    <input id="searchInput" type="search" placeholder="Cari nama barang..." aria-label="Cari nama barang" autocomplete="off" />
    <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <circle cx="11" cy="11" r="7" stroke-width="2" />
      <line x1="16.656" y1="16.656" x2="21" y2="21" stroke-width="2" stroke-linecap="round" />
    </svg>
  </div>
  <div class="table-wrapper">
    <table aria-describedby="tableInfo" role="table" tabindex="0">
      <thead>
        <tr>
          <th><input type="checkbox" id="selectAllCheckbox" aria-label="Pilih Semua Data"></th>
          <th style="width: 35px;">Id</th>
          <th>Nama Barang</th>
          <th>Brand</th>
          <th style="width: 60px;">Harga</th>
          <th style="width: 40px;">Qty</th>
          <th style="width: 80px;">Aksi</th>
        </tr>
      </thead>
      <tbody id="dataTableBody" role="rowgroup" aria-live="polite" aria-relevant="all">
        <!-- Rows will be rendered here by JS -->
      </tbody>
    </table>
  </div>
</div>

<div class="bottom-buttons" role="region" aria-label="Aksi tambah data dan generate barcode">
  <button class="primary" id="btnTambahData" aria-label="Tambah Data" type="button">
    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
    </svg>
    Tambah Data
  </button>
  <button class="secondary" id="btnGenerateBarcode" aria-label="Generate Barcode dari barang yang dipilih" type="button">
    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect>
      <line x1="3" y1="10" x2="21" y2="10"></line>
      <line x1="7" y1="5" x2="7" y2="19"></line>
      <line x1="17" y1="5" x2="17" y2="19"></line>
    </svg>
    Generate Barcode
  </button>
</div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.4); justify-content:center; align-items:center; z-index:3000;">
    <div class="modal" role="document">
      <h2 id="modalTitle">Tambah Data Barang</h2>
      <form id="addDataForm" autocomplete="off">
        <div class="form-group">
          <label for="namaBarang">Nama Barang</label>
          <input type="text" id="namaBarang" name="namaBarang" placeholder="Masukkan nama barang" required />
        </div>
        <div class="form-group">
          <label for="brand">Brand</label>
          <input type="text" id="brand" name="brand" placeholder="Masukkan brand" required />
        </div>
        <div class="form-group">
          <label for="harga">Harga</label>
          <input type="text" id="harga" name="harga" placeholder="Masukkan harga" required />
        </div>
        <div class="form-group">
          <label for="stok">Stok</label>
          <input type="number" id="stok" name="stok" min="0" placeholder="Masukkan stok" required />
        </div>
        <div class="form-group">
          <label for="barcode">Nomor Barcode</label>
          <div class="input-row">
            <input type="text" id="barcode" name="barcode" placeholder="Masukkan nomor barcode" required autocomplete="off" />
            <button type="button" id="scanBarcodeBtn" class="scan-barcode-btn" aria-label="Scan Barcode">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <path d="M7 3v18M17 3v18M3 7h18M3 17h18"></path>
              </svg>
              Scan
            </button>
          </div>
          <!-- Scanner container for Quagga -->
          <div id="scanner-container" aria-label="Scanner Barcode">
            <button id="closeScannerBtn" aria-label="Tutup Scanner">&times;</button>
            <div id="interactive" class="viewport"></div>
          </div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="cancelBtn" class="cancel-btn">Batal</button>
          <button type="submit" class="save-btn">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 2. Tambahkan HTML untuk modal barcode viewer -->
  <div class="barcode-modal-overlay" id="barcodeModalOverlay">
      <div class="barcode-modal">
          <h2>Preview Barcode</h2>
          <div class="barcode-preview-container" id="barcodePreviewContainer">
              <!-- Barcode previews akan ditampilkan di sini -->
          </div>
          <div class="barcode-actions">
              <button class="barcode-btn save-png" id="savePngBtn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                  Save PNG
              </button>
              <button class="barcode-btn save-pdf" id="savePdfBtn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                  </svg>
                  Save PDF
              </button>
              <button class="barcode-btn view-full" id="viewFullBtn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                  Lihat
              </button>
              <button class="barcode-btn close-modal" id="closeBarcodeModal">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                  Tutup
              </button>
          </div>
      </div>
  </div>

  <!-- 3. Fullscreen barcode viewer -->
  <div class="fullscreen-barcode" id="fullscreenBarcode">
      <canvas id="fullscreenCanvas"></canvas>
      <div class="fullscreen-nav">
          <button id="prevBarcode">‚ùÆ Prev</button>
          <span class="fullscreen-counter" id="fullscreenCounter">1 / 1</span>
          <button id="nextBarcode">Next ‚ùØ</button>
          <button id="closeFullscreen">‚úï Close</button>
      </div>
  </div>

  <!-- 4. Tambahkan library jsPDF untuk PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script src="firebase-config.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>


<script>
    const modalOverlay = document.getElementById('modalOverlay');
    const btnTambahData = document.getElementById('btnTambahData');
    const cancelBtn = document.getElementById('cancelBtn');
    const addDataForm = document.getElementById('addDataForm');
    const btnGenerateBarcode = document.getElementById('btnGenerateBarcode');
    const dataTableBody = document.getElementById('dataTableBody');
    const searchInput = document.getElementById('searchInput');
    const hargaInput = document.getElementById('harga'); // Ambil elemen input harga
    const barcodeInput = document.getElementById('barcode'); // Ambil elemen input barcode
    const scannerContainer = document.getElementById('scanner-container'); // Ambil elemen scanner
    const closeScannerBtn = document.getElementById('closeScannerBtn'); // Tombol tutup scanner

    let editMode = false;
    let editProductId = null;
    let products = [];
    let generatedBarcodes = [];
    let currentFullscreenIndex = 0;

    // Fungsi untuk memformat angka dengan titik sebagai pemisah ribuan
    function formatRupiah(angka) {
        let numberString = angka.replace(/[^,\d]/g, '').toString();
        let split = numberString.split(',');
        let sisa = split[0].length % 3;
        let rupiah = split[0].substr(0, sisa);
        let ribuan = split[0].substr(sisa).match(/\d{3}/gi);

        if (ribuan) {
            let separator = sisa ? '.' : '';
            rupiah += separator + ribuan.join('.');
        }

        rupiah = split[1] !== undefined ? rupiah + ',' + split[1] : rupiah;
        return rupiah;
    }

    // Event listener untuk input harga
    hargaInput.addEventListener('input', function (e) {
        let cursorPosition = hargaInput.selectionStart;
        let originalLength = hargaInput.value.length;

        // Format angka saat pengguna mengetik
        hargaInput.value = formatRupiah(hargaInput.value);

        let newLength = hargaInput.value.length;
        cursorPosition = cursorPosition + (newLength - originalLength);
        hargaInput.setSelectionRange(cursorPosition, cursorPosition);
    });

    // Fetch all products from backend
    async function fetchProducts() {
      const activeStoreId = localStorage.getItem('activeStoreId');
      try {
        const snapshot = await window.firebaseUtils.productsCollection.where('storeId', '==', activeStoreId).get();
        products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderTable(products);
      } catch (error) {
        alert('Gagal memuat data produk: ' + error.message);
      }
    }

    // Render products ke tabel
    function renderTable(data) {
      dataTableBody.innerHTML = '';
      data.forEach((product, index) => {
        const tr = document.createElement('tr');
        tr.dataset.id = product.id;
        tr.dataset.nama = product.namaBarang;
        tr.dataset.brand = product.brand;
        tr.dataset.harga = product.harga;
        tr.dataset.stok = product.stok;
        tr.dataset.barcode = product.barcode;

        tr.innerHTML = `
          <td><input type="checkbox" class="select-row" aria-label="Pilih ${product.namaBarang}"></td>
          <td>${index + 1}</td>
          <td class="name">${product.namaBarang}</td>
          <td class="brand">${product.brand}</td>
          <td class="price">
            <div class="currency">Rp</div>
            <div class="amount">${Number(product.harga).toLocaleString('id-ID')}</div>
          </td>
          <td class="stock">${product.stok}</td>
          <td class="actions">
            <button class="edit" title="Edit Barang" aria-label="Edit ${product.namaBarang}">‚úèÔ∏è</button>
            <button class="delete" title="Hapus Barang" aria-label="Hapus ${product.namaBarang}">üóëÔ∏è</button>
          </td>
        `;

        dataTableBody.appendChild(tr);
      });
    }

    // Open modal form for adding or editing
    btnTambahData.addEventListener('click', () => {
      editMode = false;
      editProductId = null;
      addDataForm.reset();
      document.getElementById('modalTitle').textContent = 'Tambah Data Barang';
      modalOverlay.style.display = 'flex';
    });

    cancelBtn.addEventListener('click', () => {
      modalOverlay.style.display = 'none';
      addDataForm.reset();
    });
  
    modalOverlay.addEventListener('click', e => {
      if (e.target === modalOverlay) {
        modalOverlay.style.display = 'none';
        addDataForm.reset();
      }
    });

    // Submit form add/edit
    // Submit form add/edit
    addDataForm.addEventListener('submit', async e => {
        e.preventDefault();

        const namaBarang = addDataForm.namaBarang.value.trim();
        const brand = addDataForm.brand.value.trim();
        const hargaRaw = addDataForm.harga.value.trim().replace(/\./g, ''); // Menghapus titik sebelum konversi
        const harga = Number(hargaRaw);
        const stok = Number(addDataForm.stok.value.trim());
        const barcode = addDataForm.barcode.value.trim();

        if (!namaBarang || !brand || isNaN(harga) || isNaN(stok) || !barcode) {
            alert('Semua field wajib diisi dengan benar.');
            return;
        }

        const activeStoreId = localStorage.getItem('activeStoreId');
        const productData = { namaBarang, brand, harga, stok, barcode, storeId: activeStoreId };

        // Cek apakah barcode sudah ada, kecuali jika sedang dalam mode edit
        const barcodeExists = products.some(product => product.barcode === barcode && product.id !== editProductId);
        if (barcodeExists) {
            alert('Nomor barcode sudah ada. Silakan gunakan nomor barcode yang lain.');
            return;
        }

        try {
            if (!editMode) {
                await window.firebaseUtils.addProduct(productData);
                alert('Produk berhasil ditambahkan');
            } else {
                await window.firebaseUtils.updateProduct(editProductId, productData);
                alert('Produk berhasil diperbarui');
            }
            modalOverlay.style.display = 'none';
            addDataForm.reset();
            fetchProducts();
        } catch (error) {
            alert(error.message);
        }
    });


    // Load data saat halaman dibuka
    fetchProducts();

    // Handle edit and delete buttons in table using event delegation
    dataTableBody.addEventListener('click', async e => {
      const target = e.target.closest('button');
      if (!target) return;

      const tr = target.closest('tr');
      const id = tr.dataset.id;

      if (target.classList.contains('edit')) {
        const product = products.find(p => p.id === id);
        if (!product) {
          alert('Produk tidak ditemukan');
          return;
        }
        editMode = true;
        editProductId = id;
        document.getElementById('modalTitle').textContent = 'Edit Data Barang';
        addDataForm.namaBarang.value = product.namaBarang;
        addDataForm.brand.value = product.brand;
        addDataForm.harga.value = Number(product.harga).toLocaleString('id-ID'); // Format harga saat edit
        addDataForm.stok.value = product.stok;
        addDataForm.barcode.value = product.barcode;
        modalOverlay.style.display = 'flex';
      } else if (target.classList.contains('delete')) {
        if (confirm(`Yakin ingin menghapus produk "${tr.dataset.nama}"?`)) {
          try {
            await window.firebaseUtils.deleteProduct(id);
            alert('Produk berhasil dihapus');
            fetchProducts();
          } catch (error) {
            alert(error.message);
          }
        }
      }
    });

    // Search filter
    searchInput.addEventListener('input', () => {
      const keyword = searchInput.value.toLowerCase();
      const filtered = products.filter(p => p.namaBarang.toLowerCase().includes(keyword));
      renderTable(filtered);
    });

// Fungsi untuk membuat canvas barcode
function createBarcodeCanvas(product) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const width = 350;
    const height = 140;
    canvas.width = width;
    canvas.height = height;

    // Background putih
    ctx.clearRect(0, 0, width, height);
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, width, height);

    // Text styling
    ctx.fillStyle = '#004a99';
    ctx.textAlign = 'center';

    // Brand dan nama barang
    ctx.font = 'bold 16px Arial, sans-serif';
    const brandNama = `${product.brand} - ${product.namaBarang}`;
    ctx.fillText(brandNama, width / 2, 30);

    // Harga
    ctx.font = 'bold 14px Arial, sans-serif';
    const hargaFormatted = 'Rp ' + Number(product.harga).toLocaleString('id-ID');
    ctx.fillText(hargaFormatted, width / 2, 55);

    // Generate barcode
    const barcodeCanvas = document.createElement('canvas');
    JsBarcode(barcodeCanvas, product.barcode, {
        format: 'CODE128',
        displayValue: true,
        fontSize: 14,
        height: 50,
        width: 2,
        margin: 0,
        textMargin: 5,
        textPosition: 'bottom',
        background: 'transparent'
    });

    // Draw barcode ke canvas utama
    const barcodeHeight = 70;
    ctx.drawImage(barcodeCanvas, (width - barcodeCanvas.width) / 2, height - barcodeHeight);

    return canvas;
}

// Fungsi untuk menampilkan modal barcode
function showBarcodeModal(selectedProducts) {
    generatedBarcodes = [];
    const container = document.getElementById('barcodePreviewContainer');
    container.innerHTML = '';

    selectedProducts.forEach((product, index) => {
        const canvas = createBarcodeCanvas(product);
        generatedBarcodes.push({
            canvas: canvas,
            product: product,
            filename: `barcode_${product.brand.replace(/\s+/g, '_')}_${product.namaBarang.replace(/\s+/g, '_')}_${product.barcode}.png`
        });

        // Buat preview item
        const itemDiv = document.createElement('div');
        itemDiv.className = 'barcode-item';
        
        const infoDiv = document.createElement('div');
        infoDiv.className = 'barcode-item-info';
        infoDiv.textContent = `${product.brand} - ${product.namaBarang}`;
        
        const canvasClone = document.createElement('canvas');
        canvasClone.width = canvas.width;
        canvasClone.height = canvas.height;
        const ctx = canvasClone.getContext('2d');
        ctx.drawImage(canvas, 0, 0);
        
        itemDiv.appendChild(infoDiv);
        itemDiv.appendChild(canvasClone);
        container.appendChild(itemDiv);
    });

    document.getElementById('barcodeModalOverlay').style.display = 'flex';
}

// Fungsi untuk download PNG (Android compatible)
// Ganti fungsi downloadAsZip dengan yang ini:
function downloadAsZip(barcodes) {
    barcodes.forEach((barcodeData, index) => {
        setTimeout(() => {
            barcodeData.canvas.toBlob(function(blob) {
                const reader = new FileReader();
                reader.onload = function() {
                    const base64data = reader.result;
                    
                    // Check if running in Android WebView (APK)
                    const isAndroidWebView = /Android/.test(navigator.userAgent) && /wv/.test(navigator.userAgent);
                    
                    if (isAndroidWebView && window.Android && window.Android.downloadFile) {
                        // Use Android interface for APK
                        window.Android.downloadFile(base64data, barcodeData.filename, 'image/png');
                    } else if (navigator.share && navigator.canShare) {
                        // Web Share API untuk browser mobile
                        const file = new File([blob], barcodeData.filename, {type: 'image/png'});
                        if (navigator.canShare({files: [file]})) {
                            navigator.share({
                                files: [file],
                                title: 'Barcode Generated',
                                text: `Barcode untuk ${barcodeData.product.namaBarang}`
                            }).catch(err => console.log('Error sharing:', err));
                        } else {
                            // Gunakan FileSaver.js untuk download
                            saveAs(blob, barcodeData.filename);
                        }
                    } else {
                        // Gunakan FileSaver.js untuk download
                        saveAs(blob, barcodeData.filename);
                    }
                };
                reader.readAsDataURL(blob);
            }, 'image/png');
        }, index * 500);
    });
}

function generatePDF(barcodes) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const margin = 10;
    const barcodeWidth = pageWidth - (margin * 2);
    const barcodeHeight = 40;
    let currentY = margin;

    barcodes.forEach((barcodeData, index) => {
        if (index > 0 && currentY + barcodeHeight > pageHeight - margin) {
            pdf.addPage();
            currentY = margin;
        }
        const imgData = barcodeData.canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', margin, currentY, barcodeWidth, barcodeHeight);
        currentY += barcodeHeight + 10;
    });

    const filename = `barcodes_${new Date().getTime()}.pdf`;
    
    // Check if running in Android WebView (APK)
    const isAndroidWebView = /Android/.test(navigator.userAgent) && /wv/.test(navigator.userAgent);
    
    if (isAndroidWebView && window.Android && window.Android.downloadFile) {
        const pdfBase64 = pdf.output('datauristring');
        // Use Android interface for APK
        window.Android.downloadFile(pdfBase64, filename, 'application/pdf');
    } else if (navigator.share && navigator.canShare) {
        const pdfBlob = pdf.output('blob');
        const file = new File([pdfBlob], filename, { type: 'application/pdf' });
        if (navigator.canShare({ files: [file] })) {
            navigator.share({
                files: [file],
                title: 'Barcode PDF',
                text: 'PDF barcode generated'
            }).catch(err => console.log('Error sharing:', err));
        } else {
            // Gunakan FileSaver.js untuk download
            const pdfBlob2 = pdf.output('blob');
            saveAs(pdfBlob2, filename);
        }
    } else {
        // Gunakan FileSaver.js untuk download
        const pdfBlob3 = pdf.output('blob');
        saveAs(pdfBlob3, filename);
    }
}


// Tambahkan fungsi fallback ini:
function fallbackDownload(dataUri, filename) {
    try {
        // Method 1: Try creating download link (might work in some webviews)
        const link = document.createElement('a');
        link.href = dataUri;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (e) {
        console.error('Download failed:', e);
        // Method 2: Open in new window so user can save manually
        const newWindow = window.open();
        if (newWindow) {
            newWindow.document.write(`
                <html>
                    <head><title>Download ${filename}</title></head>
                    <body style="margin:0;text-align:center;">
                        <h3>Tekan dan tahan gambar/file di bawah, lalu pilih "Simpan"</h3>
                        <img src="${dataUri}" style="max-width:100%;height:auto;" />
                        <br><br>
                        <a href="${dataUri}" download="${filename}">Download ${filename}</a>
                    </body>
                </html>
            `);
        } else {
            alert('Popup diblokir. Aktifkan popup untuk download atau gunakan fitur share.');
        }
    }
}

// Tambahkan pengecekan untuk Android WebView saat aplikasi dimuat:
document.addEventListener('DOMContentLoaded', function() {
    const isAndroidWebView = /Android/.test(navigator.userAgent) && /wv/.test(navigator.userAgent);
    
    if (isAndroidWebView) {
        console.log('Running in Android WebView (APK mode)');
        
        // Update button text untuk APK
        const savePngBtn = document.getElementById('savePngBtn');
        const savePdfBtn = document.getElementById('savePdfBtn');
        
        if (savePngBtn) {
            savePngBtn.innerHTML = `
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Simpan PNG
            `;
        }
        
        if (savePdfBtn) {
            savePdfBtn.innerHTML = `
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                </svg>
                Simpan PDF
            `;
        }
    }
});



// Fungsi untuk fullscreen view
function showFullscreenBarcode(index = 0) {
    currentFullscreenIndex = index;
    const fullscreenCanvas = document.getElementById('fullscreenCanvas');
    const counter = document.getElementById('fullscreenCounter');
    
    if (generatedBarcodes[index]) {
        const sourceCanvas = generatedBarcodes[index].canvas;
        fullscreenCanvas.width = sourceCanvas.width;
        fullscreenCanvas.height = sourceCanvas.height;
        
        const ctx = fullscreenCanvas.getContext('2d');
        ctx.drawImage(sourceCanvas, 0, 0);
        
        counter.textContent = `${index + 1} / ${generatedBarcodes.length}`;
    }
    
    document.getElementById('fullscreenBarcode').style.display = 'flex';
}

// Update event listener untuk generate barcode button
document.getElementById('btnGenerateBarcode').addEventListener('click', () => {
    const selectedCheckboxes = [...document.querySelectorAll('.select-row:checked')];
    if (selectedCheckboxes.length === 0) {
        alert('Pilih minimal satu item untuk generate barcode.');
        return;
    }

    const selectedProducts = selectedCheckboxes.map(cb => {
        const tr = cb.closest('tr');
        return {
            namaBarang: tr.dataset.nama,
            brand: tr.dataset.brand,
            harga: tr.dataset.harga,
            barcode: tr.dataset.barcode
        };
    });

    showBarcodeModal(selectedProducts);
});

// Event listeners untuk modal barcode
document.getElementById('savePngBtn').addEventListener('click', () => {
    downloadAsZip(generatedBarcodes);
});

document.getElementById('savePdfBtn').addEventListener('click', () => {
    generatePDF(generatedBarcodes);
});

document.getElementById('viewFullBtn').addEventListener('click', () => {
    showFullscreenBarcode(0);
});

document.getElementById('closeBarcodeModal').addEventListener('click', () => {
    document.getElementById('barcodeModalOverlay').style.display = 'none';
});

// Event listeners untuk fullscreen barcode
document.getElementById('prevBarcode').addEventListener('click', () => {
    if (currentFullscreenIndex > 0) {
        showFullscreenBarcode(currentFullscreenIndex - 1);
    }
});

document.getElementById('nextBarcode').addEventListener('click', () => {
    if (currentFullscreenIndex < generatedBarcodes.length - 1) {
        showFullscreenBarcode(currentFullscreenIndex + 1);
    }
});

document.getElementById('closeFullscreen').addEventListener('click', () => {
    document.getElementById('fullscreenBarcode').style.display = 'none';
});

// Close modal when clicking outside
document.getElementById('barcodeModalOverlay').addEventListener('click', (e) => {
    if (e.target === document.getElementById('barcodeModalOverlay')) {
        document.getElementById('barcodeModalOverlay').style.display = 'none';
    }
});

document.getElementById('fullscreenBarcode').addEventListener('click', (e) => {
    if (e.target === document.getElementById('fullscreenBarcode')) {
        document.getElementById('fullscreenBarcode').style.display = 'none';
    }
});
    
    // Quagga.js Scanner functions
    let isScanning = false;

function startQuaggaScanner() {
    if (isScanning) return;

    scannerContainer.style.display = 'block';
    isScanning = true;

    // Konfigurasi yang lebih kompatibel untuk Android
    const config = {
        inputStream: {
            type: "LiveStream",
            constraints: {
                width: { min: 320, ideal: 640, max: 1920 },
                height: { min: 240, ideal: 480, max: 1080 },
                facingMode: "environment", // Kamera belakang
                aspectRatio: { min: 1, max: 2 }
            },
            target: document.querySelector('#interactive'),
            singleChannel: false
        },
        locator: {
            patchSize: "medium",
            halfSample: true
        },
        numOfWorkers: 2,
        decoder: {
            readers: [
                "code_128_reader",
                "ean_reader",
                "ean_8_reader",
                "code_39_reader",
                "upc_reader",
                "upc_e_reader"
            ],
            debug: {
                drawBoundingBox: true,
                showFrequency: true,
                drawScanline: true,
                showPattern: true
            }
        },
        locate: true
    };

    Quagga.init(config, function(err) {
        if (err) {
            console.error('Quagga initialization error:', err);
            alert('Tidak dapat mengakses kamera. Pastikan izin kamera telah diberikan.');
            stopQuaggaScanner();
            return;
        }
        
        console.log('Quagga initialized successfully');
        Quagga.start();
    });

    // Event listener untuk deteksi barcode
    Quagga.onDetected(onBarcodeDetected);
    
    // Event listener untuk error
    Quagga.onProcessed(function(result) {
        var drawingCtx = Quagga.canvas.ctx.overlay,
            drawingCanvas = Quagga.canvas.dom.overlay;

        if (result) {
            if (result.boxes) {
                drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                result.boxes.filter(function (box) {
                    return box !== result.box;
                }).forEach(function (box) {
                    Quagga.ImageDebug.drawPath(box, {x: 0, y: 1}, drawingCtx, {color: "green", lineWidth: 2});
                });
            }

            if (result.box) {
                Quagga.ImageDebug.drawPath(result.box, {x: 0, y: 1}, drawingCtx, {color: "#00F", lineWidth: 2});
            }

            if (result.codeResult && result.codeResult.code) {
                Quagga.ImageDebug.drawPath(result.line, {x: 'x', y: 'y'}, drawingCtx, {color: 'red', lineWidth: 3});
            }
        }
    });
}

    function stopQuaggaScanner() {
    if (!isScanning) return;

    try {
        Quagga.offDetected(onBarcodeDetected);
        Quagga.offProcessed();
        Quagga.stop();
        
        // Clear canvas
        const canvas = document.querySelector('#interactive canvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
    } catch (error) {
        console.error('Error stopping Quagga:', error);
    }
    
    isScanning = false;
    scannerContainer.style.display = 'none';
}


    function onBarcodeDetected(result) {
    if (result && result.codeResult && result.codeResult.code) {
        const code = result.codeResult.code;
        console.log('Barcode detected:', code);
        
        // Isi field input barcode
        barcodeInput.value = code;
        
        // Berikan feedback kepada user
        if ('navigator' in window && 'vibrate' in navigator) {
            navigator.vibrate(200); // Vibrate untuk feedback
        }
        
        // Hentikan scanner
        stopQuaggaScanner();
        
        // Optional: tampilkan alert sukses
        setTimeout(() => {
            alert(`Barcode berhasil dipindai: ${code}`);
        }, 100);
    }
}

    // Event listener untuk tombol scan barcode
    document.getElementById('scanBarcodeBtn').addEventListener('click', function(e) {
    e.preventDefault();
    
    // Cek apakah browser mendukung getUserMedia
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Browser tidak mendukung akses kamera. Silakan gunakan browser yang lebih baru.');
        return;
    }
    
    // Request permission untuk kamera terlebih dahulu
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function(stream) {
            // Stop stream immediately, kita hanya perlu test permission
            stream.getTracks().forEach(track => track.stop());
            // Mulai scanner
            startQuaggaScanner();
        })
        .catch(function(err) {
            console.error('Camera permission error:', err);
            alert('Tidak dapat mengakses kamera. Pastikan Anda telah memberikan izin akses kamera.');
        });
});

    closeScannerBtn.addEventListener('click', function(e) {
    e.preventDefault();
    stopQuaggaScanner();
});

// Pastikan scanner berhenti saat modal ditutup
const originalModalClose = modalOverlay.addEventListener;
modalOverlay.addEventListener('click', function(e) {
    if (e.target === modalOverlay) {
        stopQuaggaScanner();
        modalOverlay.style.display = 'none';
        addDataForm.reset();
    }
});

// Pastikan scanner berhenti saat tombol cancel diklik
const originalCancelClick = cancelBtn.addEventListener;
cancelBtn.addEventListener('click', function() {
    stopQuaggaScanner();
    modalOverlay.style.display = 'none';
    addDataForm.reset();
});

    // Load data saat halaman dibuka
    fetchProducts();
</script>

</body>
</html>
